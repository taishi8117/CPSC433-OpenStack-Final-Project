package project;

import java.util.HashMap;
import java.util.Random;

import lib.SubnetAddress;
import object.Network;

/**
 * Controller Instance
 * @author TAISHI
 *
 */
public class Controller {
	// maps tenantID to Hash Map of Network (mapping network ID to Network) 
	private HashMap<Long, HashMap<Long,Network>> tenantMap;
	

	// Miscellaneous
	public Random randomGen;
	
	
	public Controller() {
		// TODO Auto-generated constructor stub
		this.tenantMap = new HashMap<Long, HashMap<Long,Network>>();
		this.randomGen = new Random();
	}
	
	
	
	/**
	 * Assigns available priavte address space for a subset.
	 * Should be called when a new subnet is created to assign
	 * the range of IP address
	 * @return SubnetAddress
	 */
	public SubnetAddress getAvailableSubnetAddr() {
		//TODO return available range of IP address as SubnetAddress instance
		return null;
	}
	
	/**
	 * Registers a new tenant to this controller
	 * @return tenant ID that was registered
	 */
	public long registerNewTenant() {
		long tenantID;
		
		// randomly generate tenant ID until it finds a new one
		do {
			tenantID = randomGen.nextLong();
		} while (tenantMap.containsKey(tenantID));
		
		HashMap<Long, Network> networkMap = new HashMap<Long, Network>();
		
		tenantMap.put(tenantID, networkMap);
		return tenantID;
	}
	
	/**
	 * Registers a new network to a specified tenant.
	 * It creates a new Network instance, assigning a new available network ID.
	 * @return Created Network instance on success; otherwise null
	 */
	public Network registerNewNetwork(long tenantID, String networkName) {
		HashMap<Long, Network> networkMap = tenantMap.get(tenantID);
		if (networkMap == null) {
			return null;
		}
		
		long networkID;
		// randomly generate network ID until it finds a new one
		do {
			networkID = randomGen.nextLong();
		} while (networkMap.containsKey(networkID));
		
		Network network = new Network(this, networkName, tenantID, networkID);

		
		networkMap.put(networkID, network);
		return network;
	}

}
